<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>ä¸Šå‚³æ¸¬è©¦ + æ­·å²ç´€éŒ„</title>
  <style>
    body { font-family: sans-serif; padding: 2em; }
    input, button { margin: 0.5em 0; padding: 0.5em; width: 100%; }
    table { width: 100%; border-collapse: collapse; margin-top: 2em; }
    th, td { border: 1px solid #ccc; padding: 0.5em; text-align: center; }
    .ok { color: green; }
    .fail { color: red; }
  </style>
</head>
<body>
  <h1>ğŸ“¤ ä¸Šå‚³ UID è³‡æ–™</h1>
  <form id="uploadForm">
    <label>UID: <input type="text" id="uid" required></label><br>
    <label>Direction: <input type="text" id="direction" required></label><br>
    <label>Device Name: <input type="text" id="deviceName" required></label><br>
    <label>Device Time: <input type="datetime-local" id="deviceTime" required></label><br>
    <button type="submit">é€å‡º</button>
  </form>

  <div id="result"></div>

  <h2>ğŸ“‹ æ­·å²ç´€éŒ„</h2>
  <button onclick="fetchLogs()">é‡æ–°è¼‰å…¥ç´€éŒ„</button>
  <table>
    <thead>
      <tr>
        <th>ID</th><th>UID</th><th>æ–¹å‘</th><th>è¨­å‚™</th><th>æ™‚é–“</th><th>æˆæ¬Š</th><th>ä½¿ç”¨è€…</th>
      </tr>
    </thead>
    <tbody id="logTable"></tbody>
  </table>

  <script>
    const server = "http://localhost:4000";

    document.getElementById('uploadForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      const data = {
        value1: uid.value,
        value2: direction.value,
        value3: deviceName.value,
        value4: deviceTime.value
      };

      try {
        const res = await fetch(`${server}/upload`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        const json = await res.json();
        if (json.success) {
          result.innerHTML = `<p class="ok">âœ… ä¸Šå‚³æˆåŠŸï¼æˆæ¬Šï¼š${json.authorized ? "âœ… æ˜¯" : "âŒ å¦"}ï¼Œä½¿ç”¨è€…ï¼š${json.user}</p>`;
          fetchLogs();
        } else {
          result.innerHTML = `<p class="fail">âŒ ç™¼ç”ŸéŒ¯èª¤: ${JSON.stringify(json)}</p>`;
        }
      } catch (err) {
        result.innerHTML = `<p class="fail">âŒ ç™¼ç”ŸéŒ¯èª¤: ${err}</p>`;
      }
    });

    async function fetchLogs() {
      try {
        const res = await fetch(`${server}/logs`);
        const logs = await res.json();

        const table = logs.map(log => `
          <tr>
            <td>${log.id}</td>
            <td>${log.uid}</td>
            <td>${log.direction}</td>
            <td>${log.device_name}</td>
            <td>${log.device_time}</td>
            <td>${log.authorized ? "âœ…" : "âŒ"}</td>
            <td>${log.username}</td>
          </tr>
        `).join("");
        document.getElementById("logTable").innerHTML = table;
      } catch (e) {
        document.getElementById("logTable").innerHTML = `<tr><td colspan="7">è¼‰å…¥å¤±æ•—ï¼š${e}</td></tr>`;
      }
    }

    // åˆå§‹è¼‰å…¥
    fetchLogs();
  </script>
</body>
</html>
